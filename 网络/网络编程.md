# 网络编程

## 网络字节序

计算机是大端法(高位在高地址，地位低地址)，网络小端法，网络字节序和主机字节序的转换

```
#include<arpa/inet.h>
uint32_t htonl(uint32_t,hostlong) ===> 本地转网络ip
uint16_t htons(uint16_t,hostshort) ===>本地转网络端口
uint32_t ntohl(uint32_t,netlong) ===>网络转本地ip
uint16_t ntohs(uint16_t,netshort)===>网络转本地端口
```

192.168.1.130=>string=>atoi=>int=>htonl=>网络字节流

为了方便转换，提供了封装函数

IP地址转换函数

```c
#include <arpa/inet.h> // 本地字节序到网络字节序
int inet_pton(int af, const char *src, void *dst);
af：AF_INET 、 AF_INET6 (ipv4和ipv6)
src：传入ip地址(点分十进制)
dst:传出，转换后的网络字节序ip地址
返回值：
    成功：1
    异常：0 不存在
    失败：-1 非法
    
#include <arpa/inet.h> // 网络字节序到本地字节序
const char *inet_ntop(int af, const void *src,
                      char *dst, socklen_t size);
af：AF_INET 、 AF_INET6 (ipv4和ipv6)
src：网络字节序ip地址
dst: (点分十进制)
size：dst大小
返回值：
    成功：dst
    失败：null
```

sockaddr数据结构

![image-20211217144601733](D:\document\learn_summary\网络\图例\sockaddr.png)

```c
struct sockaddr_in {
     sa_family_t    sin_family; /* address family: AF_INET */
     in_port_t      sin_port;   /* port in network byte order */
     struct in_addr sin_addr;   /* internet address */
 };

/* Internet address. */
struct in_addr {
    uint32_t       s_addr;     /* address in network byte order */
};
```

连接过程

<img src="C:\Users\E00437\AppData\Roaming\Typora\typora-user-images\image-20211217144046199.png" alt="image-20211217144046199" style="zoom: 67%;" />

```
bind()绑定IP+port
listen() 设置监听上限
accept()阻塞监听客户端连接
```

